<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link type="text/css" href="/stylesheets/ui-lightness/jquery-ui-1.8.2.custom.css" rel="Stylesheet" />	
    <style type="text/css" title="currentStyle">
      @import "/stylesheets/demo_page.css";
      @import "/stylesheets/demo_table_jui.css";
    </style>
    <style type="text/css">
      #dynamic_2 label, #dialog-form label { width:7em; float:left;  display:block;  color: #1c94c4; font-weight:bold;}
		  #dynamic_2 input, #dialog-form input { width:13em; float:rigth; display:block; }
		  input.text {margin-bottom:2px; padding: .2em; }
		  fieldset { padding:0; border:0;}
		  h1 { font-size: 1.2em; margin: .6em 0; }
		  div#users-contain { width: 200px; margin: 20px 0; }
		  div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
		  div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
		  .ui-dialog .ui-state-error { padding: .3em; }
		  .validateTips { border: 1px solid transparent; padding: 0.3em; }
	  </style>
    <script src="/javascripts/jquery-1.4.2.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.dataTables.js" type="text/javascript"></script>
    <script type="text/javascript" src="/javascripts/jquery-ui-1.8.2.custom.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.ui.datepicker-da.js"></script>
    <script type="text/javascript" charset="utf-8">
        var oPersonTable;
        var oMedlemlogTable;
        var Aktivitet = {
	        10:'Indmeldelses dato',
	        20:'PBS opkrævnings dato',
	        30:'Kontingent betalt til dato',
	        40:'PBS betaling tilbageført',
	        50:'Udmeldelses dato',
        };
        
        $(document).ready(function() {

        oPersonTable = $('#person').dataTable( {
          "bJQueryUI": true,
          "sPaginationType": "full_numbers",
          //"sDom": 'firtlp',
          "bAutoWidth": false, 
          "bProcessing": true,
          "bStateSave": true,
          "aLengthMenu": [[20, 40, 100, -1],[20, 40, 100, "Alle"]],
          "aoColumnDefs": [
			        { "sWidth": "1em", "sClass": 'left', "sTitle": "Nr", "bVisible": true, "aTargets": [ 0 ] },
			        { "sClass": 'left', "sTitle": "Navn", "bVisible": true, "aTargets": [ 1 ] },
			        { "sClass": 'left', "sTitle": "Kaldenavn", "bVisible": false, "aTargets": [ 2 ] },
			        { "sClass": 'left', "sTitle": "Adresse", "bVisible": true, "aTargets": [ 3 ] },
			        { "sWidth": "3em", "sClass": 'left', "sTitle": "Pnr", "bVisible": true, "aTargets": [ 4 ] },
			        { "sWidth": "7em", "sClass": 'left', "sTitle": "By", "bVisible": false, "aTargets": [ 5 ] },
			        { "sClass": 'left', "sTitle": "Email", "bVisible": false, "aTargets": [ 6 ] },
			        { "sWidth": "5em", "sClass": 'left', "sTitle": "Telefon", "bVisible": false, "aTargets": [ 7 ] },
			        { "sWidth": "3em", "sClass": 'left', "sTitle": "Køn", "bVisible": false, "aTargets": [ 8 ] },
			        { "sWidth": "8em", "sClass": 'left', "sTitle": "Født dato", "bVisible": false, "aTargets": [ 9 ] },
			        { "sWidth": "10em", "sClass": 'left', "sTitle": "Bank", "bVisible": false, "aTargets": [ 10 ] }
            ],
          "fnInitComplete":function( oSettings, json ) {
            $(oSettings.aoData).each( function() {
              var id = $(this)[0]._aData[0];
              var nRow = $(this)[0].nTr;
              $(nRow).attr("id",id);
              $(nRow).click( function(){
                var aPos = oPersonTable.fnGetPosition( this ); 
                medlemUpdate(aPos)
              });
            });
          },
          /*
          "fnRowCallback": function( nRow, aData, iDisplayIndex ) {
            var id = aData[0];
            $(nRow).attr("id",id);
            if ( $.data( $(nRow).get(0), 'events' ) === null  || ( $.data( $(nRow).get(0), 'events' ) !== null && $.data( $(nRow).get(0), 'events' ).click === null ) )
            {
              $(nRow).click( function() { alert('this: ' + $(this)[0].outerHTML); } );
            }
            var foo2 = $.data( $(nRow).get(0), 'events' ).click;
            return nRow;
          },
          */
          "sAjaxSource": "/adm/medlemjson"
        } );
        
        oMedlemlogTable = $('#medlemlog').dataTable( {
          "sDom": 'rt',
          "bJQueryUI": true,
          "bAutoWidth": false,
          "bPaginate": false,          
          "bProcessing": false,
          "bStateSave": true,
          "aoColumnDefs": [
			        { "sWidth": "1em", "sClass": 'left', "sTitle": "Nr", "bVisible": false, "aTargets": [ 0 ] },
			        { "sWidth": "1em", "sClass": 'left', "sTitle": "Source", "bVisible": false, "aTargets": [ 1 ] },
			        { "sWidth": "1em", "sClass": 'left', "sTitle": "Source_id", "bVisible": false, "aTargets": [ 2 ] },
			        { "sWidth": "10em", "sClass": 'left', "sTitle": "Logdato", "bVisible": false, "aTargets": [ 3 ] },
			        { "sWidth": "11em", "sClass": 'left', "sTitle": "Aktivitet", "bVisible": true, "fnRender": function ( oObj ) {return Aktivitet[oObj.aData[4]];}, "aTargets": [ 4 ] },
			        { "sWidth": "5em", "sClass": 'left', "sTitle": "Dato", "bVisible": true, "fnRender": function ( oObj ) {return oObj.aData[5].substring(0,10);}, "aTargets": [ 5 ] }
            ],
          "sAjaxSource": "/adm/medlemlogjson"
        } );

        $("#dialog-form").dialog({
          autoOpen: false,
			    modal: true,
          width: 300,
			    buttons: {
				    Ok: function() {
 				      var pos = $("#pos").val();
              oPersonTable.fnUpdate( [
                 $("#nr").val()
                ,$("#navn").val()
                ,$("#kaldenavn").val()
                ,$("#adresse").val()
                ,$("#postnr").val()
                ,$("#bynavn").val()
                ,$("#email").val()
                ,$("#telefon").val()
                ,$("#kon").val()
                ,$("#fodtdato").val()
                ,$("#bank").val()
                ], pos, 0); 
              
              $.ajax({
                url: "/adm/updatemedlem",
                type: 'POST',
                data: {
                   Nr: $("#nr").val()
                  ,Navn: $("#navn").val()
                  ,Kaldenavn: $("#kaldenavn").val()
                  ,Adresse: $("#adresse").val()
                  ,Postnr: $("#postnr").val()
                  ,Bynavn: $("#bynavn").val()
                  ,Email: $("#email").val()
                  ,Telefon: $("#telefon").val()
                  ,Kon: $("#kon").val()
                  ,FodtDato: $("#fodtdato").val()
                  ,Bank: $("#bank").val()
                }
              });              
              
              $(this).dialog('close');
				    }
			    }
		    });
 
        $('#fodtdato').datepicker({
           dateFormat: 'yy-mm-dd',
           changeMonth: true,
           changeYear: true,
           yearRange: '1920:2010' 
        });
       
      });                
      
      function medlemUpdate(aPos) {
        var aData = oPersonTable.fnGetData( aPos ); 
        $("#xnr").val(aData[0]);
        $("#xnavn").val(aData[1]);
        $("#xkaldenavn").val(aData[2]);
        $("#xadresse").val(aData[3]);
        $("#xpostnr").val(aData[4]);
        $("#xbynavn").val(aData[5]);
        $("#xemail").val(aData[6]);
        $("#xtelefon").val(aData[7]);
        $("#xkon").val(aData[8]);
        $("#xfodtdato").val(aData[9]);
        $("#xbank").val(aData[10]);
        oMedlemlogTable.fnFilter('^' + aData[0] + '$',0,true,false);
        oMedlemlogTable.fnSort( [ [3,'desc'], [4,'desc'] ] ); 
        $("#pos").val(aPos);
        $("#nr").val(aData[0]);
        $("#navn").val(aData[1]);
        $("#kaldenavn").val(aData[2]);
        $("#adresse").val(aData[3]);
        $("#postnr").val(aData[4]);
        $("#bynavn").val(aData[5]);
        $("#email").val(aData[6]);
        $("#telefon").val(aData[7]);
        $("#kon").val(aData[8]);
        $("#fodtdato").val(aData[9]);
        $("#bank").val(aData[10]);
   	    //$("#dialog-form").dialog('open');
      } 
      
    </script>
    <title>Find Medlem</title>
  </head>
  <body id="dt_example" style="margin-top:10px;">
    <div id="dynamic_2" style="width:35%; float:left; margin-left:1%;">
		  <fieldset>
        <label for="xnr">Nr</label><input style="width:3em;" type="text" name="xnr" id="xnr" class="text ui-widget-content ui-corner-all" />
		    <label for="xnavn">Navn</label><input type="text" name="xnavn" id="xnavn" class="text ui-widget-content ui-corner-all" />
        <label for="xkaldenavn">Kaldenavn</label><input type="text" name="xkaldenavn" id="xkaldenavn" class="text ui-widget-content ui-corner-all" />
        <label for="xadresse">Adresse</label><input type="text" name="xadresse" id="xadresse" value="" class="text ui-widget-content ui-corner-all" />
        <label for="xpostnr">Postnr</label><input style="width:3em;" type="text" name="xpostnr" id="xpostnr" value="" class="text ui-widget-content ui-corner-all" />
        <label for="xbynavn">By</label><input style="width:7em;" type="text" name="xbynavn" id="xbynavn" value="" class="text ui-widget-content ui-corner-all" />
        <label for="xemail">Email</label><input type="text" name="xemail" id="xemail" value="" class="text ui-widget-content ui-corner-all" />
        <label for="xtelefon">Telefon</label><input style="width:5em;" type="text" name="xtelefon" id="xtelefon" value="" class="text ui-widget-content ui-corner-all" />
        <label for="xkon">Køn</label><input style="width:1em;" type="text" name="xkon" id="xkon" value="" class="text ui-widget-content ui-corner-all" />
		    <label for="xfodtdato">FødtDato</label><input style="width:5em;" type="text" name="xfodtdato" id="xfodtdato" value="" class="text ui-widget-content ui-corner-all" />
        <label for="xbank">Bank</label><input type="text" name="xbank" id="xbank" value="" class="text ui-widget-content ui-corner-all" />
      </fieldset>
      <table class="display" id="medlemlog">
        <thead>
          <tr >
            <th>Nr</th>
            <th>Source</th>
            <th>Source_id</th>
            <th>Logdato</th>
            <th>Akt_id</th>
            <th>Akt_dato</th>
          </tr>
        </thead>          
        <tbody>
        </tbody>  
      </table>
    </div>

    <div id="dynamic" style="float:left;width:60%;">
      <table class="display" id="person">
        <thead>
          <tr >
            <th>Nr</th>
            <th>Navn</th>
            <th>Kaldenavn</th>
            <th>Adresse</th>
            <th>Postnr</th>
            <th>By</th>
            <th>Email</th>
            <th>Telefon</th>
            <th>Køn</th>
            <th>FødtDato</th>
            <th>Bank</th>
          </tr>
        </thead>          
        <tbody>
        </tbody>  
      </table>
    </div>
    
    <div id="dialog-form" title="Update user">
	    <form>
	      <fieldset>
		      <input type="hidden" name="pos" id="pos"/>
		      <label for="nr">Nr</label><input style="width:5em;" type="text" name="nr" id="nr" class="text ui-widget-content ui-corner-all" />
		      <label for="navn">Navn</label><input type="text" name="navn" id="navn" class="text ui-widget-content ui-corner-all" />
		      <label for="kaldenavn">Kaldenavn</label><input type="text" name="kaldenavn" id="kaldenavn" class="text ui-widget-content ui-corner-all" />
		      <label for="adresse">Adresse</label><input type="text" name="adresse" id="adresse" value="" class="text ui-widget-content ui-corner-all" />
		      <label for="postnr">Postnr</label><input style="width:10em;" type="text" name="postnr" id="postnr" value="" class="text ui-widget-content ui-corner-all" />
		      <label float:left;" for="bynavn">By</label><input type="text" name="bynavn" id="bynavn" value="" class="text ui-widget-content ui-corner-all" />
		      <label float:left;" for="email">Email</label><input type="text" name="email" id="email" value="" class="text ui-widget-content ui-corner-all" />
		      <label for="telefon">Telefon</label><input style="width:10em;" type="text" name="telefon" id="telefon" value="" class="text ui-widget-content ui-corner-all" />
		      <label for="kon">Køn</label><input style="width:1em;" type="text" name="kon" id="kon" value="" class="text ui-widget-content ui-corner-all" />
		      <label for="fodtdato">FødtDato</label><input style="width:10em;" type="text" name="fodtdato" id="fodtdato" value="" class="text ui-widget-content ui-corner-all" />
		      <label for="bank">Bank</label><input type="text" name="bank" id="bank" value="" class="text ui-widget-content ui-corner-all" />
	      </fieldset>
	    </form>
    </div>
  </body>
</html>
